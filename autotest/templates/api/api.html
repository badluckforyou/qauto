<!DOCTYPE html>
{% load static %}
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>{{ title }}</title>
    <!-- plugins:css -->
    <link rel="stylesheet" href="{% static 'vendors/iconfonts/mdi/css/materialdesignicons.css' %}">
    <!-- endinject -->
    <!-- vendor css for this page -->
    <!-- End vendor css for this page -->
    <!-- inject:css -->
    <link rel="stylesheet" href="{% static 'css/shared/style.css' %}">
    <!-- endinject -->
    <!-- Layout style -->
    <link rel="stylesheet" href="{% static 'css/demo_1/style.css' %}">
    <!-- Layout style -->
    <link rel="shortcut icon" href="{% static 'images/favicon.ico' %}" />
    <script type="text/javascript">
      window.onload = function(){
        $("#project").val("{{ project }}");
        $("#platform").val("{{ platform }}");
      }
    </script>
  </head>
  <body class="header-fixed" id="thebody">
    <!-- partial:partials/_header.html -->
    <nav class="t-header">
      <div class="t-header-brand-wrapper">
        <a>
          <img class="logo" src="{% static 'images/logo.png' %}" alt="">
          <img class="logo-mini" src="{% static 'images/logo_mini.png' %}" alt="">
        </a>
      </div>
      <div class="t-header-content-wrapper">
        <div class="t-header-content">
          <button class="t-header-toggler t-header-mobile-toggler d-block d-lg-none">
            <i class="mdi mdi-menu"></i>
          </button>
          <form action="#" class="t-header-search-box">
            <div class="input-group">
              <input type="text" class="form-control" id="inlineFormInputGroup" placeholder="Search" autocomplete="off">
              <button class="btn btn-primary" type="submit"><i class="mdi mdi-arrow-right-thick"></i></button>
            </div>
          </form>
          <ul class="nav ml-auto">
            <li class="nav-item dropdown">
              <a class="nav-link" href="#" id="notificationDropdown" data-toggle="dropdown" aria-expanded="false">
                <i class="mdi mdi-account mdi-1x">{{ username }}</i>
              </a>
              <div class="dropdown-menu navbar-dropdown dropdown-menu-right" aria-labelledby="notificationDropdown" style="width: 130px;">
                <div class="dropdown-body">
                  <div class="dropdown-list">
                    <div class="rounded-circle bg-inverse-primary text-primary">
                    </div>
                    <div class="content-wrapper" onclick="location.href='/user/';">
                      <small class="content-text">My information</small>
                    </div>
                  </div>
                  <div class="dropdown-list" onclick="location.href='/login/';">
                    <div class="rounded-circle bg-inverse-warning text-warning">
                    </div>
                    <div class="content-wrapper">
                      <small class="content-text">Logout</small>
                    </div>
                  </div>
                </div>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <!-- partial -->
    <div class="page-body">
      <!-- partial:partials/_sidebar.html -->
      <div class="sidebar">
        <div class="user-profile">
          <div class="display-avatar animated-avatar">
            <img class="profile-img img-lg rounded-circle" src="{% static 'images/image.png' %}" alt="profile image">
          </div>
          <div class="info-wrapper">
            <h3 class="user-name">{{ company }}</h3>
          </div>
        </div>
        <ul class="navigation-menu">
          <li class="nav-category-divider">HOME</li>
          <li>
            <a href="/home/">
              <span class="link-title">主页</span>
              <i class="mdi mdi-home link-icon"></i>
            </a>
          </li>
          <li class="nav-category-divider">AUTOMATED TESTING</li>
          <li>
            <a href="/automation/">
              <span class="link-title">自动化测试</span>
              <i class="mdi mdi-application link-icon"></i>
            </a>
          </li>
          <li>
            <a href="/automation/result/">
              <span class="link-title">结果</span>
              <i class="mdi mdi-application link-icon"></i>
            </a>
          </li>
          <li class="nav-category-divider">API TESTING</li>
          <li>
            <a>
              <span class="link-title">接口测试</span>
              <i class="mdi mdi-application link-icon"></i>
            </a>
          </li>
          <li>
            <a href="/api/result/">
              <span class="link-title">结果</span>
              <i class="mdi mdi-application link-icon"></i>
            </a>
          </li>
          <li class="nav-category-divider">STRESS TESTING</li>
          <li>
            <a href="/stress/">
              <span class="link-title">压力测试</span>
              <i class="mdi mdi-application link-icon"></i>
            </a>
          </li>
          <li>
            <a href="/stress/result/">
              <span class="link-title">结果</span>
              <i class="mdi mdi-application link-icon"></i>
            </a>
          </li>
          <li class="nav-category-divider">USER</li>
          <li>
            <a href="/user/">
              <span class="link-title">My Information</span>
              <i class="mdi mdi-account link-icon"></i>
            </a>
          </li>
        </ul>
      </div>
      <!-- partial -->
      <div class="page-content-wrapper">
        <div class="page-content-wrapper-inner">
          <div class="content-viewport">
            <div class="row">
              <div class="modal" id="requestHeaders" data-backdrop="true" style="position: fixed;">
                <div class="modal-dialog modal-lg">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h6 class="modal-title">
                        <strong>Request Headers</strong>
                      </h6>
                    </div>
                    <div class="modal-body">
                      <label>以字典的形式写入Headers</label>
                      <textarea class="form-control" rows="10" cols="10" id="headers">{
    "Content-Type": "application/x-www-form-urlencoded;charset=utf-8"
}</textarea>
                    </div>
                    <div class="modal-footer">
                      <a class="btn btn-success btn-sm" id="clearHeaders">
                        Clear
                      </a>
                      <a class="btn btn-success btn-sm" data-dismiss="modal">
                        Save
                      </a>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-lg-6 equel-grid">
                <div class="grid">
                  <div class="grid-body py-3">
                    <div class="split-header">
                      <p class="card-title">Send Data</p>
                    </div>
                  </div>
                  <div class="vertical-timeline-wrapper">
                    <div class="row mb-3">
                      <div class="col-md-11 mx-auto">
                        <div class="form-group row showcase_row_area">
                          <div class="col-md-2 showcase_text_area">
                            <select class="custom-select" id="methods" name="methods" style="padding: 0 15px;height: 30px;">
                              {% for method in methods %}
                              <option>{{ method }}</option>
                              {% endfor %}
                            </select>
                          </div>
                          <div class="col-md-7 showcase_text_area">
                            <input type="text" class="form-control" name="targetUrl" id="targetUrl" value="http://192.168.1.37:8080/">
                          </div>
                          <div class="col-md-2 showcase_text_area">
                            <button class="btn btn-inverse-primary component-flat" id="startTest" style="padding: 0 15px;height: 30px;">
                              Send Request
                            </button>
                          </div>
                          <div class="col-md-1 showcase_text_area">
                            <button class="btn action-btn btn-xs component-flat" data-toggle="modal" data-target="#requestHeaders">
                              <i class="mdi mdi-settings text-muted mdi-2x"></i>
                            </button>
                          </div>
                        </div>
                        <div class="form-group row showcase_row_area">
                          <div class="col-md-12 showcase_content_area">
                            <label style="width: 200px;">Request Data </label>
                            <label style="width: 70px;">data type </label>
                            <label>
                              <select class="custom-select" id="dataType" name="dataType" style="padding: 0 15px;height: 30px;">
                                {% for type in datatype %}
                                <option>{{ type }}</option>
                                {% endfor %}
                              </select>
                            </label>
                            <textarea class="form-control" rows="20" id="requestData" style="font-size: 15px; color: #000000; font-family:courier;">{
    'opera': 'test',
    'userid': 10000,
    'username': 'tester',
    'child|data': {
        'info': true,
        'return': false
    },
    'remember': false
}</textarea>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="grid-body py-3" id="randomTitle">
                    <div class="split-header">
                      <p class="card-title">Random Test</p>
                        <button type="button" class="btn btn-trasnparent action-btn btn-xs component-flat pr-0" id="removeRandom">
                          <i class="mdi mdi-window-close text-muted mdi-2x"></i>
                        </button>
                    </div>
                  </div>
                  <div class="vertical-timeline-wrapper" id="randomWrapper">
                    <div class="row mb-3">
                      <div class="col-md-11 mx-auto">
                        <div class="form-group row showcase_row_area">
                          <div class="col-md-12 showcase_content_area">
                            <label>Execute Times</label>
                            <label>
                              <input class="form-control" type="" name="randomTimes" id="randomTimes" value="1" style="width: 70px;">
                            </label>
                            <label>
                              <span class="btn btn-trasnparent action-btn btn-xs component-flat pr-0" data-toggle="tooltip" data-placement="right" title="执行x次api测试">
                                <i class="mdi mdi-information-outline text-muted mdi-2x"></i>
                              </span>
                            </label>
                            <textarea class="form-control" rows="15" id="randomData" style="font-size: 15px; color: #000000; font-family:courier">// 若要添加带有, ()'|\字符的测试数据, 需要在字符前添加\
// string类型的测试数据, 需以''包裹
// random_between, 从1至100随机取值, 仅用于int/float类型
userid: random_between(1, 100)
// random_in, 从各个值中随机取值
username: random_in('t', 't\,e', 'tes', 'te\ st', 'te\(ste', 'tes\)ter','tes\[ter','tes\]ter')
// x|y, {'x':{'y': z}}改变z的值; in_order, 按顺序取值
child\|data|info: in_order(true, 'true', 'True', false, 'false', 'False')
// in_order, 按顺序取值
remember: in_order(true, false)
</textarea>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-6 equel-grid">
                <div class="grid">
                  <div class="grid-body py-3">
                    <div class="split-header">
                      <p class="card-title">Receive Data</p>
                      <div class="btn-group">
                        <button class="btn action-btn btn-refresh btn-xs component-flat" onclick="refresh()">
                          <i class="mdi mdi-autorenew text-muted mdi-2x"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="vertical-timeline-wrapper">
                    <div class="row mb-3">
                      <div class="col-md-11 mx-auto">
                        <div class="form-group row showcase_row_area">
                          <div class="col-md-12 showcase_content_area">
                            <textarea class="form-control" id="recvData" rows="43" style="font-size: 15px; color: #000000; font-family:courier" readonly>Empty data.</textarea>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- page content ends -->
    </div>
    <!--page body ends -->
    <!-- SCRIPT LOADING START FORM HERE /////////////-->
    <!-- plugins:js -->
    <script src="{% static 'vendors/js/core.js' %}"></script>
    <!-- endinject -->
    <!-- Vendor Js For This Page Ends-->
    <script src="{% static 'vendors/apexcharts/apexcharts.min.js' %}"></script>
    <script src="{% static 'vendors/chartjs/Chart.min.js' %}"></script>
    <script src="{% static 'js/charts/chartjs.addon.js' %}"></script>
    <!-- Vendor Js For This Page Ends-->
    <!-- build:js -->
    <script src="{% static 'js/template.js' %}"></script>
    <script src="{% static 'js/dashboard.js' %}"></script>
    <!-- endbuild -->
    <script type="text/javascript">
      $(window).on("load", function(){
      });
      var halfWindowHeight = $(window).height() / 2;
      /****** 设置modal 显示的坐标 ******/
      function setModalHeight(modal, height){
        modal.css("display", "block");
        modal.css({
          "margin-top": height,
        });
      }
      $("#requestHeaders").on("show.bs.modal", function(e){
        var modalHeight = $(this).height();
        var windowHeight = $(window).height();
        console.log(modalHeight);
        console.log((modalHeight - windowHeight) / 2);
        setModalHeight($(this), (modalHeight - windowHeight) / 2);
      });
      function showRecv(data){
        $("#recvData").removeAttr("readonly");
        $("#recvData").val(data);
        $("#recvData").attr("readonly", "readonly");
      }
      function refresh(){
        showRecv("Empty Data.");
      }
      $("#removeRandom").click(function(){
        $("#randomWrapper").css("display", "none");
        $("#randomTitle").css("display", "none");
        $("#requestData").attr("rows", 41);
      });
      $("#clearHeaders").click(function(){
        console.log($("#headers").val());
        $("#headers").val("");
      });
      $("#startTest").click(function(){
        var method = $("#methods").val();
        var dataType = $("#dataType").val();
        var targetUrl = $("#targetUrl").val();
        var requestData = $("#requestData").val();
        var headers = $("#headers").val();
        if ($("#randomWrapper").css("display") == "block"){
          var randomTimes = $("#randomTimes").val();
          var randomData = $("#randomData").val();
        }
        else {
          var randomTimes = "";
          var randomData = "";
        }
        $.ajax({
          cache: false,
          url: "request/",
          dataType: 'text',
          type: 'POST',
          async: true,
          data: {
            "method": method,
            "url": targetUrl,
            "headers": headers,
            "data": requestData,
            "dataType": dataType,
            "randomData": randomData,
            "randomTimes": randomTimes,
          },
          success: function(data){
            showRecv(JSON.parse(data));
          }
        });
      });
    </script>
  </body>
</html>